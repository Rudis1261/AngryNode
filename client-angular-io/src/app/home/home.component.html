<h1><i class="icon-message"></i> Firebase chat test</h1>

<ul id="chat" *ngIf="(messages | async)?.length">
  <li class="text" *ngFor="let message of messages | async">
    <span class="name" [class.active]="newMessage.name == message.name">{{message.name}}:&nbsp;</span> {{message.text}}
  </li>
</ul>

<div class="row loading-heading" *ngIf="!loaded">
    <div class="col-12">loading...</div>
</div>

<div class="row loading-heading" *ngIf="loaded && !(messages | async)?.length">
    <div class="col-12">No messages yet, go ahead. Add one</div>
</div>
    
<form 
    validation="false"
    (ngSubmit)="onSubmit(newMessageForm)"
    #newMessageForm="ngForm"
>
    <div class="row">
        <div class="col-3">
            <input 
                type="text"
                required 
                name="name" 
                placeholder="Name" 
                [(ngModel)]="newMessage.name" 
                [disabled]="lockName"
                #errorName="ngModel" 
            />
            <div 
                [hidden]="(errorName.valid || !errorName.touched || lockName)" 
                class="error"
            >Invalid</div>
        </div>
        <div class="col-8">
            <input 
                type="text" 
                required 
                name="text" 
                placeholder="Message" 
                [(ngModel)]="newMessage.text" 
                #errorMessage="ngModel"
            />
            <div 
                [hidden]="(errorMessage.valid || !errorMessage.touched)"
                class="error"
            >Invalid</div>
        </div>
        <div class="col-1"><button type="submit">&gt;</button></div>
    </div>
</form>

<div class="row" *ngIf="loaded && (messages | async)?.length">
    <a href="#" (click)="clear()" class="small block text-center">Remove all messages</a>
</div>